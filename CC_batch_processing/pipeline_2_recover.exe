#!/bin/sh
START_POINT=$1
module load python/3.6
module load sextractor/2.19.5
source $HOME/projects/def-sfabbro/tensorflow-cpu/bin/activate
unset XDG_RUNTIME_DIR
export OMP_NUM_THREADS=16





COUNTER=0
while [  $COUNTER -lt 3 ]; do
    
    
    #download the image
    echo $(($START_POINT+$COUNTER)) | python dwnld_recover.py

    #run SE
    #sex /home/toyonaga/scratch/pipeline/full/full_$(($START_POINT+$COUNTER)).fits -c parameters.se -CATALOG_NAME /home/toyonaga/scratch/pipeline/cat/image_$(($START_POINT+$COUNTER)).cat

    #make cutouts and do detections and save output

    echo $(($START_POINT+$COUNTER)) | python run_predictions_recover.py



    rm /home/toyonaga/scratch/pipeline/full/full_$(($START_POINT+$COUNTER)).fits /home/toyonaga/scratch/pipeline/cat/image_$(($START_POINT+$COUNTER)).cat
    
    
    
    let COUNTER=COUNTER+1 
done